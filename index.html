<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Baby Tracker</title>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .card { background:#fff; border:1px solid #eee; border-radius:14px; padding:16px; box-shadow: 0 2px 6px rgba(0,0,0,.05); }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    button { border:0; background:#4f46e5; color:#fff; padding:10px 14px; border-radius:10px; cursor:pointer; }
    button.secondary { background:#10b981; }
    button.warn { background:#f59e0b; }
    input, select { padding:8px 10px; border:1px solid #ddd; border-radius:10px; }
    .muted{ color:#666; font-size:12px; }
    pre { white-space:pre-wrap; word-wrap:break-word; }
    .container{ max-width:720px; margin:20px auto; padding:0 12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Newborn Tracker</h1>
    <div class="muted">Family code: <b id="code"></b></div>

    <div class="card" style="margin-top:12px;">
      <div class="row">
        <h3 style="margin:0;">Bottle</h3>
        <input id="amount" type="number" step="0.1" min="0" placeholder="Amount" style="width:90px">
        <select id="unit"><option>ounces</option><option>ml</option></select>
        <button id="btnFeed">Save feeding</button>
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <button class="warn" id="btnWet">Wet diaper</button>
      <button class="warn" id="btnDirty">Dirty diaper</button>
      <button class="secondary" id="btnNursing">Nursing</button>
      <button id="btnNext">Next feed?</button>
    </div>

    <div class="card" style="margin-top:12px;">
      <div class="row">
        <button id="btnHist">Refresh history</button>
        <span class="muted">Shows last entries from your Google Sheet</span>
      </div>
      <pre id="out" style="margin-top:10px;"></pre>
    </div>
  </div>

<script>
const API = 'https://script.google.com/macros/s/AKfycbwTfYoSP4gETZuP23oCjo33OMYDAVVez6sMAs9St5oj_u4FszTrAYphWr3eBZzPMGUpeA/exec';
const FAMILY_CODE = 'angel-family-8927'; // change to your code
document.getElementById('code').textContent = FAMILY_CODE;

async function post(path, body){
  const r = await fetch(`${API}?path=${encodeURIComponent(path)}`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(body)
  });
  if(!r.ok){ throw new Error('API error '+r.status); }
  return r.json().catch(()=> ({}));
}

async function get(path, qs){
  const url = `${API}?path=${encodeURIComponent(path)}${qs?('&'+qs):''}`;
  const r = await fetch(url);
  if(!r.ok){ throw new Error('API error '+r.status); }
  return r.json();
}

// actions
document.getElementById('btnFeed').onclick = async () => {
  const amount = Number(document.getElementById('amount').value || 0);
  const unit = document.getElementById('unit').value;
  try{
    await post('feed', { userId:FAMILY_CODE, amount, unit, source:'formula', at:new Date().toISOString() });
    alert('Feeding saved'); loadHistory();
  }catch(e){ alert('Failed: '+e.message); }
};

document.getElementById('btnWet').onclick = async () => {
  try{
    await post('diaper', { userId:FAMILY_CODE, type:'wet', at:new Date().toISOString() });
    alert('Wet diaper saved'); loadHistory();
  }catch(e){ alert('Failed: '+e.message); }
};

document.getElementById('btnDirty').onclick = async () => {
  try{
    await post('diaper', { userId:FAMILY_CODE, type:'dirty', at:new Date().toISOString() });
    alert('Dirty diaper saved'); loadHistory();
  }catch(e){ alert('Failed: '+e.message); }
};

document.getElementById('btnNursing').onclick = async () => {
  try{
    // nursing logs as source='breast', amount 0
    await post('feed', { userId:FAMILY_CODE, amount:0, unit:'ounces', source:'breast', at:new Date().toISOString() });
    alert('Nursing saved'); loadHistory();
  }catch(e){ alert('Failed: '+e.message); }
};

document.getElementById('btnNext').onclick = async () => {
  try{
    const data = await get('next-feed', 'userId='+encodeURIComponent(FAMILY_CODE));
    if (data.nextISO){
      const when = new Date(data.nextISO).toLocaleTimeString([], {hour:'numeric', minute:'2-digit'});
      alert('Next feeding around: '+when);
    } else {
      alert('Need more feeding history first.');
    }
  }catch(e){ alert('Failed: '+e.message); }
};

document.getElementById('btnHist').onclick = loadHistory;

async function loadHistory(){
  try{
    const data = await get('history', 'userId='+encodeURIComponent(FAMILY_CODE));
    const feeds = (data.feeds||[]).map(f => ({type:'feeding', amount:f.amount, unit:f.unit, source:f.source, timestamp:f.timestamp}));
    const diapers = (data.diapers||[]).map(d => ({type:'diaper', kind:d.type, timestamp:d.timestamp}));
    const merged = feeds.concat(diapers).sort((a,b)=> new Date(b.timestamp)-new Date(a.timestamp));
    document.getElementById('out').textContent = JSON.stringify(merged, null, 2);
  }catch(e){
    document.getElementById('out').textContent = 'Error: '+e.message;
  }
}

// basic PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => navigator.serviceWorker.register('sw.js'));
}
</script>
  <script src="app.js"></script>
<h1>Baby Tracker</h1>
<button onclick="logDiaper('wet')">Log Wet Diaper</button>
<button onclick="logDiaper('dirty')">Log Dirty Diaper</button>
<button onclick="logFeed(4, 'bottle')">Log 4oz Bottle</button>

<h2>History</h2>
<ul id="logs"></ul>

</body> 
  
</html>
